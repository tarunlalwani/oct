# ADR-002: UUIDv7 for Task IDs

## Status
Accepted

## Context
Task identifiers must be globally unique across workspaces and sortable by creation time for efficient listing operations. UUIDv4 provides uniqueness but is random, preventing time-based sorting. Auto-incrementing integers are sortable but expose sequence information and require coordination in distributed systems.

We need identifiers that are:
1. Globally unique without coordination
2. Lexicographically sortable by creation time
3. Opaque (no embedded business meaning)

## Decision
Use UUIDv7 (timestamp + random) for all task identifiers.

UUIDv7 structure (128 bits):
- 48 bits: Unix timestamp (milliseconds since epoch)
- 4 bits: version (0111 = 7)
- 12 bits: random
- 2 bits: variant (10)
- 62 bits: random

Implementation in `packages/infra/src/utils/uuidv7.ts`:
```typescript
export function generateUUIDv7(): string {
  const bytes = generateUUIDv7Bytes();
  return bytesToUUIDString(bytes);
}
```

The repository generates IDs via `repository.generateId()`, delegating to the UUIDv7 implementation:
```typescript
generateId(): string {
  return generateUUIDv7();
}
```

## Consequences

**Positive:**
- **Lexicographically sortable**: Tasks sort by creation time without index lookups
- **Distributed-safe**: No central coordination required for ID generation
- **Time-extractable**: Creation timestamp can be extracted from the ID itself
- **Standard format**: Compatible with UUID parsers and validators

**Negative:**
- **Monotonicity not guaranteed**: IDs from the same millisecond have random ordering
- **Clock dependency**: System clock changes can affect ordering (mitigated by not relying on strict ordering)
- **Storage size**: 36 characters vs. 16 bytes for binary UUID or 8 bytes for bigint

**Neutral:**
- The `extractTimestampFromUUIDv7()` utility allows debugging and analytics to determine creation time without database access
